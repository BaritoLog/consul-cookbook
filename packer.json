{
  "variables": {
    "build_version": "{{env `BUILD_VERSION`}}",
    "build_commit_sha": "{{env `BUILD_COMMIT_SHA`}}",
    "cookbooks_path": "{{env `COOKBOOKS_PATH`}}"
  },
  "builders": [
    {
      "type": "lxd",
      "image": "ubuntu:18.04",
      "output_image": "lxd-consul-{{user `build_version`}}",
      "publish_properties": {
        "version": "{{user `build_version`}}",
        "commit_sha": "{{user `build_commit_sha`}}",
        "description": "LXD image for consul"
      },
      "init_sleep": "5"
    }
  ],
  "provisioners": [
    {
      "type": "chef-solo",
      "cookbook_paths": ["{{user `cookbooks_path`}}"],
      "run_list": ["recipe[consul::default]"]
    }
  ]
}
